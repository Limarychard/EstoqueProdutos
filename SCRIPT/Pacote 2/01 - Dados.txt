CREATE TABLE FORNECEDORES(
    ID_FORNECEDOR INT PRIMARY KEY IDENTITY(1,1),
    NOME_FORNECEDOR NVARCHAR(255) NOT NULL,    
    TELEFONE BIGINT NOT NULL,                
    CPF_CNPJ BIGINT NULL,                    
    CEP VARCHAR(10) NOT NULL,       
    ESTADO NVARCHAR(2) NOT NULL,
    CIDADE NVARCHAR(255) NOT NULL,
    BAIRRO NVARCHAR(255) NOT NULL,
    RUA NVARCHAR(255) NOT NULL,             
    NUMERO_ENDERECO NVARCHAR(50) NOT NULL,   
    TEM_COMPLEMENTO BIT NOT NULL,            
    COMPLEMENTO NVARCHAR(255),                                 
    DT_ULT_COMPRA DATETIME NULL,             
    DT_ALT DATETIME NOT NULL DEFAULT GETDATE(), 
    DT_INC DATETIME NOT NULL DEFAULT GETDATE(), 
    ID_USUARIO INT NOT NULL,                 
    CONSTRAINT FK_Usuario_Fornecedores FOREIGN KEY (ID_USUARIO) REFERENCES Usuarios (ID)
);

ALTER TABLE CLIENTES ALTER COLUMN CEP VARCHAR(10);

EXEC sp_rename 'CLIENTES.TEM_COMPLEMENTO', 'NAO_TEM_COMPLEMENTO'
EXEC sp_rename 'FORNECEDORES.TEM_COMPLEMENTO', 'NAO_TEM_COMPLEMENTO'

ALTER TABLE CLIENTES
DROP COLUMN CASA_APTO

CREATE TABLE COMPRAS (
    ID_COMPRA INT PRIMARY KEY IDENTITY(1,1),
    ID_FORNECEDOR INT NOT NULL,
    VALOR_DA_COMPRA DECIMAL(9,2) NOT NULL,
    FORMA_PAGAMAENTO INT NOT NULL,
    PARCELADO BIT NOT NULL,
    QTDE_PARCELA INT NOT NULL,
    QTDE_PRODUTO INT NOT NULL,
    DT_INC DATETIME NOT NULL DEFAULT GETDATE(),
    DT_ALT DATETIME NOT NULL DEFAULT GETDATE(),
    ID_USUARIO INT NOT NULL,
    FOREIGN KEY (ID_FORNECEDOR) REFERENCES Fornecedores(ID_FORNECEDOR),
    FOREIGN KEY (ID_USUARIO) REFERENCES Usuarios(ID)
);

CREATE TABLE ProdutoCompra(
    ID_PRODUTO_COMPRA INT PRIMARY KEY IDENTITY(1,1),
    ID_COMPRA INT NOT NULL,
    ID_PRODUTO INT NOT NULL,
    NOME_PRODUTO NVARCHAR(255) NULL,
    QTDE_PRODUTO INT NOT NULL,
    VALOR_PRODUTO NUMERIC(9,2) NOT NULL,
    FOREIGN KEY (ID_PRODUTO) REFERENCES Produtos(ID_PRODUTO)
);

ALTER TABLE ProdutoCompra
ADD CONSTRAINT FK__ProdutoCo__ID_CO__2704CA5F
FOREIGN KEY (ID_COMPRA)
REFERENCES COMPRAS(ID_COMPRA)
ON DELETE CASCADE;
